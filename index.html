<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>Добро пожаловать</title>
</head>

<style>
  * {
    margin: 0;
    box-sizing: border-box;
    font-family: sans-serif;
  }

  body {
    height: 100vh;
    margin: 0;
    padding: 15px;
  }

  .message-form {
    display: flex;
    flex-direction: column;
    margin: 0 auto;
    max-width: 700px;
    height: 100%;
    gap: 7px;
  }

  .message-form * {
    flex: 0 0 auto;
  }

  #message {
    resize: none;
  }

  #message-area {
    flex: 1 1 auto;
    overflow-y: scroll;
  }

  .message span {
    font-weight: bold;
  }
</style>

<body>

  <form action="" class="message-form" id="message-form">
    <input name="username" type="text" placeholder="Имя пользователя">
    <textarea name="message-field" id="message" cols="30" rows="7" placeholder="Сообщение"></textarea>
    <input type="submit">
    <div id="message-area"></div>
  </form>
</body>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io()

  socket.on('connect', function () {
    console.log('connected:', socket.id)
  })

  socket.on('newmsg', function (user, msgtext) {
    console.log(user, msgtext)

    const message = createNewMessage(user, msgtext)
    document.getElementById('message-area').appendChild(message)
  })

  function createNewMessage(user, message) {
    const username = document.createElement('span')
    username.innerText = user + ": "

    const p = document.createElement('p')
    p.classList.add('message')
    p.appendChild(username)
    p.append(message)

    return p
  }

  function formSubmitHandler(e) {
    e.preventDefault()

    const user = e.target.username.value.trim()
    const msg = e.target.message.value.trim()

    if (user === '')
      return alert('Заполните имя пользователя')
    if (msg === '')
      return alert('Введите сообщение')

    socket.emit('msg', user, msg)
  }

  function submitOnEnter(e) {
    if (e.which === 13) {
      e.target.form.dispatchEvent(new Event('submit', { cancelable: true }));
      e.preventDefault();
      e.target.value = ''
    }
  }

  document.getElementById('message').addEventListener('keypress', submitOnEnter);
  document.getElementById('message-form').addEventListener('submit', formSubmitHandler)
</script>

</html>